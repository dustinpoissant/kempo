<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Permission Component Test</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kempo-css@1.3.2/dist/kempo.min.css">
	<script>window.litDisableBundleWarning = true;</script>
</head>
<body>
	<nav class="p bg-dark c-light">
		<h5>Permission Component Test</h5>
	</nav>
	<main class="p">
		<h2>Testing k-permission Component</h2>
		<p>This page demonstrates hiding content based on user permissions.</p>

		<div class="mt">
			<h3>Everyone Can See This</h3>
			<p>This content is always visible.</p>
		</div>

		<k-permission requires="content:read">
			<div class="mt p br bg-success c-white">
				<h3>Content Readers</h3>
				<p>You have content:read permission (all roles)</p>
			</div>
		</k-permission>

		<k-permission requires="content:create">
			<div class="mt p br bg-info c-white">
				<h3>Content Creators</h3>
				<p>You have content:create permission (contributor and above)</p>
			</div>
		</k-permission>

		<k-permission requires="content:publish">
			<div class="mt p br bg-warning">
				<h3>Content Publishers</h3>
				<p>You have content:publish permission (editor and above)</p>
			</div>
		</k-permission>

		<k-permission requires="user:delete">
			<div class="mt p br bg-danger c-white">
				<h3>User Managers</h3>
				<p>You have user:delete permission (super admin only)</p>
			</div>
		</k-permission>

		<k-permission requires="content:create,content:publish">
			<div class="mt p br bg-primary c-white">
				<h3>Create AND Publish</h3>
				<p>You have BOTH content:create AND content:publish (editor and above)</p>
			</div>
		</k-permission>

		<k-permission requires="content:create,user:delete" any>
			<div class="mt p br">
				<h3>Create OR Delete Users</h3>
				<p>You have EITHER content:create OR user:delete (using any="true")</p>
			</div>
		</k-permission>

		<div class="mt">
			<h3>Check Your Permissions</h3>
			<button id="checkBtn" class="p-sm br">Check All Permissions</button>
			<pre id="output" class="mt p br bg-light"></pre>
		</div>
	</main>

	<script type="module">
		import '../kempo/components/Permission.js';
		import { listPermissions, checkPermissions } from '../kempo/auth.js';

		document.getElementById('checkBtn').addEventListener('click', async () => {
			const output = document.getElementById('output');
			output.textContent = 'Loading...';

			try {
				const allPerms = await listPermissions();
				const permNames = allPerms.permissions.map(p => p.name);
				const result = await checkPermissions(permNames);
				
				output.textContent = JSON.stringify(result, null, 2);
			} catch(error) {
				output.textContent = 'Error: ' + error.message;
			}
		});
	</script>
</body>
</html>
