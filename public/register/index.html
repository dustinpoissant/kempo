<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta
		name="viewport"
		content="width=device-width, initial-scale=1.0"
	>
	<link rel="icon" type="image/png" sizes="48x48" href="../media/icon48.png">
	<link rel="manifest" href="../manifest.json" />
	<title>Register</title>
	<link rel="stylesheet" href="../kempo-css/kempo.min.css">
	<script>window.litDisableBundleWarning = true;</script>
</head>
<body>
	<k-import src="/nav"></k-import>
	<main class="p">
		<div style="max-width: 400px; margin: 0 auto;">
			<h2>Register</h2>
			<form id="registerForm">
				<div class="mb">
					<label for="name" class="d-b mb-sm">Name</label>
					<input type="text" id="name" name="name" required class="w-full p-sm br">
				</div>
				<div class="mb">
					<label for="email" class="d-b mb-sm">Email</label>
					<input type="email" id="email" name="email" required class="w-full p-sm br">
				</div>
				<div class="mb">
					<label for="password" class="d-b mb-sm">Password</label>
					<input type="password" id="password" name="password" required class="w-full p-sm br">
				</div>
				<div id="error" class="mb c-error" style="display: none;"></div>
				<button type="submit" class="w-full p-sm br">Register</button>
			</form>
			<p class="mt">Already have an account? <a href="/login">Login</a></p>
		</div>
	</main>
	<script src="/kempo-ui/components/Import.js" type="module"></script>
	<script type="module">
		import { register } from '../kempo/sdk.js';
		import Toast from '/kempo-ui/components/Toast.js';

		const form = document.getElementById('registerForm');
		const errorDiv = document.getElementById('error');

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			errorDiv.style.display = 'none';

			const name = document.getElementById('name').value;
			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;

			try {
				const result = await register({ name, email, password });
				if(result.requiresVerification){
					window.location.href = '/verify-email';
				} else {
					window.location.href = '/account';
				}
			} catch(error) {
				Toast.error(error.message);
			}
		});
	</script>
</body>
</html>