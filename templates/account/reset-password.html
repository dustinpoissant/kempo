<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password</title>
  <link rel="stylesheet" href="/styles.css">
  <script type="module">
    import auth from '/auth.js';

    window.resetPassword = async () => {
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const token = document.getElementById('token').value;
      const errorDiv = document.getElementById('error');
      const successDiv = document.getElementById('success');

      errorDiv.textContent = '';
      errorDiv.style.display = 'none';
      successDiv.textContent = '';
      successDiv.style.display = 'none';

      if(!password || !confirmPassword){
        errorDiv.textContent = 'Please fill in all fields';
        errorDiv.style.display = 'block';
        return;
      }

      if(password !== confirmPassword){
        errorDiv.textContent = 'Passwords do not match';
        errorDiv.style.display = 'block';
        return;
      }

      if(password.length < 8){
        errorDiv.textContent = 'Password must be at least 8 characters';
        errorDiv.style.display = 'block';
        return;
      }

      try {
        const result = await auth.resetPassword({
          newPassword: password,
          token: token
        });

        if(result.error){
          errorDiv.textContent = result.error.message || 'Failed to reset password';
          errorDiv.style.display = 'block';
          return;
        }

        successDiv.textContent = 'Password reset successful! Redirecting to login...';
        successDiv.style.display = 'block';

        setTimeout(() => {
          window.location.href = '/account/login';
        }, 2000);

      } catch(error){
        console.error('Reset password error:', error);
        errorDiv.textContent = error.message || 'An error occurred';
        errorDiv.style.display = 'block';
      }
    };
  </script>
</head>
<body>
  <div class="container">
    <h1>Reset Password</h1>
    
    <div id="error" style="display: none; color: red; margin-bottom: 1rem;"></div>
    <div id="success" style="display: none; color: green; margin-bottom: 1rem;"></div>
    
    <form onsubmit="event.preventDefault(); resetPassword();">
      <input type="hidden" id="token" value="{{TOKEN}}">
      
      <div>
        <label for="password">New Password:</label>
        <input type="password" id="password" required minlength="8">
      </div>
      
      <div>
        <label for="confirm-password">Confirm Password:</label>
        <input type="password" id="confirm-password" required minlength="8">
      </div>
      
      <button type="submit">Reset Password</button>
    </form>
    
    <p>
      <a href="/account/login">Back to Login</a>
    </p>
  </div>
</body>
</html>
