<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta
		name="viewport"
		content="width=device-width, initial-scale=1.0"
	>
	<link rel="icon" type="image/png" sizes="48x48" href="../media/icon48.png">
	<link rel="manifest" href="../manifest.json" />
	<title>My Account</title>
	<link rel="stylesheet" href="../kempo-css/kempo.min.css">
	<script>window.litDisableBundleWarning = true;</script>
</head>
<body>
	<k-import src="../nav-1.inc.html"></k-import>
	<main class="p">
		<div style="max-width: 600px; margin: 0 auto;">
			<h2>My Account</h2>
			<div id="loading">Loading...</div>
			<div id="accountInfo" style="display: none;">
				<div class="mb">
					<strong>Name:</strong> <span id="userName"></span>
				</div>
				<div class="mb">
					<strong>Email:</strong> <span id="userEmail"></span>
				</div>
				<div class="mb">
					<strong>Email Verified:</strong> <span id="emailVerified"></span>
				</div>
				<div class="mb">
					<strong>Member Since:</strong> <span id="createdAt"></span>
				</div>
				<k-role requires="contributor">
					<a href="/kempo" class="btn primary">Admin Panel</a>
				</k-role>
				<button id="logoutBtn" class="btn danger">Logout</button>
			</div>
		</div>
	</main>
	<script src="https://cdn.jsdelivr.net/npm/kempo-ui@0.0.42/dist/components/Import.js" type="module"></script>
	<script type="module">
		import '../kempo/components/Role.js';
		import { getSession, logout } from '../kempo/auth.js';

		const loadingDiv = document.getElementById('loading');
		const accountInfoDiv = document.getElementById('accountInfo');
		const logoutBtn = document.getElementById('logoutBtn');

		async function loadAccount() {
			try {
				const session = await getSession();
				
				if(!session || !session.user) {
					window.location.href = '/account/login';
					return;
				}

				document.getElementById('userName').textContent = session.user.name;
				document.getElementById('userEmail').textContent = session.user.email;
				document.getElementById('emailVerified').textContent = session.user.emailVerified ? 'Yes' : 'No';
				document.getElementById('createdAt').textContent = new Date(session.user.createdAt).toLocaleDateString();

				loadingDiv.style.display = 'none';
				accountInfoDiv.style.display = 'block';
			} catch(error) {
				window.location.href = '/account/login';
			}
		}

		logoutBtn.addEventListener('click', async () => {
			try {
				await logout();
				window.location.href = '/';
			} catch(error) {
				console.error('Logout failed:', error);
			}
		});

		loadAccount();
	</script>
</body>
</html>
