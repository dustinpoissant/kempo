import Component from"./Component.js";import{escapeHTML,unescapeHTML}from"../utils/string.js";import"./Split.js";import"./Tabs.js";import"./CodeEditor.js";const changeHandler=Symbol();export default class WebSnippetEditor extends Component{constructor(){super(),this[changeHandler]=()=>{this.renderResults()},this.registerAttribute("useKempo",!1),this.registerAttribute("showHtml",!0),this.registerAttribute("showCss",!0),this.registerAttribute("showJs",!0)}async render(){await super.render();const t=this.querySelector('pre[for="html"]'),e=this.shadowRoot.getElementById("html");e.addEventListener("change",this[changeHandler]),e.value=escapeHTML(t?t.textContent:"<div>\n  \n</div>");const n=this.querySelector('pre[for="css"]'),s=this.shadowRoot.getElementById("css");s.addEventListener("change",this[changeHandler]),s.value=n?n.textContent:"div {\n  \n}";const o=this.querySelector('pre[for="js"]'),r=this.shadowRoot.getElementById("js");r.addEventListener("change",this[changeHandler]),r.value=o?o.textContent:"",this.renderResults()}renderResults(){const t=this.shadowRoot.getElementById("html").value,e=this.shadowRoot.getElementById("css").value,n=this.shadowRoot.getElementById("js").value,s=this.shadowRoot.getElementById("results");s.innerHTML="";const o=document.createElement("iframe");o.frameBorder="0",s.appendChild(o);const r=o.contentDocument||o.contentWindow.document;if(r.body.innerHTML=`\n      ${this.useKempo?'<link rel="stylesheet" href="/kempo/kempo.css" />':""}\n      <style>\n        body, html {\n          background-color: transparent;\n        }\n        body {\n          overflow-y: auto;\n          padding: var(--spacer_q, 4px);\n        }\n        ${e}\n      </style>\n      ${t}\n    `,this.useKempo){const t=document.createElement("script");t.type="module",t.src="/kempo/kempo.js",r.body.appendChild(t)}const i=document.createElement("script");i.textContent=n,r.head.appendChild(i)}get shadowTemplate(){return`\n      <k-split id="split">\n        <k-tabs class="ml">\n          ${this.showHtml?'<k-tab for="html">HTML</k-tab>':""}\n          ${this.showCss?'<k-tab for="css">CSS</k-tab>':""}\n          ${this.showJs?'<k-tab for="js">JS</k-tab>':""}\n          <k-tab-content name="html">\n            <k-code-editor\n              id="html"\n              language="xml"\n              class="my"\n            ></k-code-editor>\n          </k-tab-content>\n          <k-tab-content name="css">\n            <k-code-editor\n              id="css"\n              language="css"\n              class="my"\n            ></k-code-editor>\n          </k-tab-content>\n          <k-tab-content name="js">\n            <k-code-editor\n              id="js"\n              language="js"\n              class="my"\n            ></k-code-editor>\n          </k-tab-content>\n        </k-tabs>\n        <div\n          id="results"\n          slot="right"\n        ></div>\n      </k-split>\n    `}get shadowStyles(){return"\n      :host {\n        --min-height: auto;\n        --height: auto;\n        --max-height: auto;\n        display: block;\n      }\n      k-tab-content {\n        min-height: var(--min-height);\n        height: var(--height);\n        max-height: var(--max-height);\n      }\n      k-code-editor {\n        max-height: calc(100% - (2 * var(--spacer)));\n      }\n      #results,\n      iframe {\n        width: 100%;\n        height: 100%;\n        background-color: transparent;\n      }\n    "}}window.customElements.define("k-web-snippet-editor",WebSnippetEditor);